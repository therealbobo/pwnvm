---
- hosts: all
  become: true
  become_user: root
  tasks:
    - name: Set a hostname
      ansible.builtin.hostname:
        name: pwnvm

    - name: apt update
      apt:
        upgrade: "yes"
        update_cache: yes

    - name: remove unwanted packages
      apt:
        name:
          - accountservice
          - snapd
        state: absent

    - name: install packages
      apt:
        pkg:
          - git
          - vim
          - gdb
          - python3
          - python3-pip
          - tmux
          - nasm
          - python3-dev
          - libssl-dev
          - libffi-dev
          - build-essential
          - socat
          - ruby
          - gcc

    - name: upgrade pip
      pip: 
        name: pip
        extra_args: --upgrade

    - name: install pwntools
      pip: 
        name: pwntools
        extra_args: --upgrade

    - name: Download radare2 
      become: true
      become_user: vagrant
      git:
        repo: https://github.com/radare/radare2.git
        dest: /home/vagrant/.radare2

    - name: Install radare2
      shell: sys/install.sh
      args:
        chdir: /home/vagrant/.radare2

    - name: update r2pm
      become: true
      become_user: vagrant
      command: r2pm update

    - name: install r2ghidra
      become: true
      become_user: vagrant
      command: r2pm -ci r2ghidra

    - name: Download peda
      git:
        repo: https://github.com/longld/peda.git
        dest: /opt/peda

    - name: Install peda
      command: echo "source /opt/peda/peda.py" >> /home/vagrant/.gdbinit

    - name: Download gef
      get_url:
        url: https://raw.githubusercontent.com/hugsy/gef/master/gef.py
        dest: /opt/gef.py

    - name: find motd files
      find:
        paths: /etc/update-motd.d/
        patterns: '*'
      register: files_to_delete

    - name: delete motd files
      file:
        path: "{{ item.path }}"
        state: absent
      with_items: "{{ files_to_delete.files }}"

    - name: copy banner
      copy:
        src: ./00-banner
        dest: /etc/update-motd.d/
        force: yes
        mode: +x

    - name: copy tmux.conf
      copy:
        src: ./.tmux.conf
        dest: /home/vagrant
        force: yes

    - name: install one_gadget
      gem:
        name: one_gadget
        state: latest

    - name: install ropper
      pip: 
        name: ropper
        extra_args: --upgrade

